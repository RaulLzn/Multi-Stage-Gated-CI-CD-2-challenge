name: 'ğŸ›¡ï¸ Architecture Validator'

on:
  pull_request:
    paths:
      - '.github/workflows/deploy.yml'

jobs:
  validate_architecture:
    runs-on: ubuntu-latest
    steps:
      - name: 'âœ… Checkout Source Code'
        uses: actions/checkout@v2

      - name: 'ğŸ” Verify deploy.yml exists'
        run: |
          if [ ! -f .github/workflows/deploy.yml ]; then
            echo "âŒ El archivo .github/workflows/deploy.yml no existe."
            exit 1
          fi
          echo "âœ… Archivo deploy.yml encontrado."

      - name: 'ğŸ” Validate Build Job'
        run: |
          grep -q "build:" .github/workflows/deploy.yml
          echo "âœ… Job 'build' encontrado."

      - name: 'ğŸ” Validate Deploy-Dev Job'
        run: |
          grep -q "deploy-dev:" .github/workflows/deploy.yml && \
          grep -A 5 "deploy-dev:" .github/workflows/deploy.yml | grep -q "needs: build" && \
          grep -A 5 "deploy-dev:" .github/workflows/deploy.yml | grep -q "environment: Dev"
          echo "âœ… Job 'deploy-dev' tiene 'needs: build' y 'environment: Dev'."

      - name: 'ğŸ” Validate Deploy-Prod Job'
        run: |
          grep -q "deploy-prod:" .github/workflows/deploy.yml && \
          grep -A 5 "deploy-prod:" .github/workflows/deploy.yml | grep -q "needs: deploy-dev" && \
          grep -A 5 "deploy-prod:" .github/workflows/deploy.yml | grep -q "environment: Production"
          echo "âœ… Job 'deploy-prod' tiene 'needs: deploy-dev' y 'environment: Production'."

      - name: 'ğŸ‰ Architecture validation passed'
        run: echo "Â¡Excelente! La arquitectura del pipeline es correcta."
